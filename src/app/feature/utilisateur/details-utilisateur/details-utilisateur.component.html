
<div *ngIf="loading" style="position:absolute;z-index:100;width:100%;height:100%;background-color:black;opacity: 0.7;left:0%;top:0%">
    <div style="position:absolute;z-index:100;top:40%;left:45%;background-color:black;opacity: 0.7;">
     <p-progressSpinner></p-progressSpinner>
    </div>
   </div>
<div style="display: inline-flex;">
    <p-button icon="pi pi-arrow-left z-50"  (onClick)="retourPage()" [rounded]="true" [text]="true" title="retour en arrière" [raised]="true" severity="help" />
    <h1 class="p-4">Details User</h1>

</div>

<div class="card">
    <h4 class="card-title">-- Details Utilisateur --</h4>
    <div class="input-container">
        <!-- Champ 1 -->
        <div class="input-item">
            <label for="inputField1" class="custom-label">Nom de l'utilisateur</label>
            <input
                id="inputField1"
                type="text"
                pInputText
                [value]="utilisateur.lastName"

                class="custom-input"
                readonly
            />
        </div>
        <!-- Champ 2 -->

        <div class="input-item">
            <label for="inputField1" class="custom-label">Prenom de l'utilisateur</label>
            <input
                id="inputField1"
                type="text"
                pInputText
                class="custom-input"
                readonly
                [value]="utilisateur.firstName"
            />
        </div>

        <!-- Champ 3 -->
        <div class="input-item">
            <label for="inputField1" class="custom-label">Adresse mail </label>
            <input
                id="inputField1"
                type="text"
                pInputText
                class="custom-input"
                readonly
                [value]="utilisateur.email"
            />
        </div>
        <div class="input-item">
            <label for="inputField1" class="custom-label">Role de l'utilisateur</label>
            <input
                id="inputField1"
                type="text"
                pInputText
                class="custom-input"
                readonly
                [value]="utilisateur.role"
            />
        </div>
        
    </div> <br>
</div>
<!--p-divider align="center">
    <div class="inline-flex align-items-center" style="color:#060;">
        <i class="pi pi-info-circle user"></i>
        <b>User Infos</b>
    </div>
</p-divider>
<p-splitter [style]="{'height': '100px'}">
    <ng-template pTemplate>
        <div class="col-8 flex align-items-center justify-content-center" style="width: 400px;">
            <div class="p-fluid">
                <div class="titleWrap">
                    <label for=""  class="propertyTitle" style="margin-top: 10px;">Nom:</label>
                    <label for=""  class="propertyTitle"  style="margin-top: 10px;">Prenom:</label>

                </div>
                <div class="valueWrap" >
                    <label for=""  class="propertyValue"  style="margin-top: 10px;" *ngIf="utilisateur.email===''"> </label>
                    <label for=""  class="propertyValue"  style="margin-top: 10px;" *ngIf="utilisateur.email!==''"> {{utilisateur.firstName}}</label>
                    <label for=""  class="propertyValue"  style="margin-top: 10px;" *ngIf="utilisateur.lastName===''"> ""</label>

                    <label for=""  class="propertyValue"  style="margin-top: 10px;"> {{utilisateur.lastName}}</label>

                </div>
            </div>
        </div>    
    </ng-template>
    <ng-template pTemplate>
        <div class="col-8 flex align-items-center justify-content-center" style="width: 400px;">
            <div class="p-fluid">
                <div class="titleWrap">
                    <label for=""  style="margin-top: 10px;" class="propertyTitle">Email:</label>
                    <label for=""  style="margin-top: 10px;" class="propertyTitle">Role:</label>
                    
                </div>
                <div class="valueWrap" >
                    <label for=""  style="margin-top: 10px;"  class="propertyValue" > {{utilisateur.email}}</label>
                    <label for=""  style="margin-top: 10px;" class="propertyValue"  > {{utilisateur.role}}</label>

                </div>
            </div>
        </div>
    </ng-template>
</p-splitter>


<p-divider align="center">
    <div class="inline-flex align-items-center" style="color:#060;">
        <i class="pi pi-info-circle user"></i>
        <b>Historique</b>
    </div>
</p-divider-->

<div class="card">
    <p-tabView>
        <p-tabPanel *ngIf="utilisateur && organisation && (utilisateur.role === ORG_ADMIN || utilisateur.role === 'Administrateur d\'organisation')" header="Organisation">
            <div class="card">

                <p-table #dt  
                [value]="organisation" 
                [rowHover]="true" 
                [rows]="5" 
                [paginator]="true" 
                [rowsPerPageOptions]="[5,10,15,25,50]" 
                dataKey="id"
                currentPageReportTemplate="Affichage {first} à {last} sur {totalRecords} utilisateurs"
                [globalFilterFields]="['firstName','lastName','email']"
                class="min-w-full">
   
         <ng-template pTemplate="header">
           <tr class="bg-green-700 text-left text-sm text-gray-700">
             <th class="px-6 py-3">Nom</th>
             <th class="px-6 py-3">Organisation parent</th>
             <th class="px-6 py-3">Description</th>
            
           </tr>
         </ng-template>
   
         <ng-template pTemplate="body" let-organisation>
           <tr class="hover:bg-gray-50">
             <td class="px-6 py-3">{{ organisation.name }}</td>
             <td class="px-6 py-3" *ngIf="organisation.parentOrganisation != null">
                {{ organisation.parentOrganisation.name }}
            </td>
            <td class="px-6 py-3" *ngIf="organisation.parentOrganisation == null">
                 ""
            </td>
            <td class="px-6 py-3">
                {{organisation.description}}
            </td>
            
              
           </tr>
         </ng-template>
   
         <ng-template pTemplate="emptymessage">
           <tr>
             <td colspan="5" class="text-center py-4 text-gray-500">Aucun utilisateur disponible</td>
           </tr>
         </ng-template>
   
         <ng-template pTemplate="paginatorleft" *ngIf="organisation">
           <div class="text-sm text-gray-600">
             Total: {{ organisation.length || 0 }} organisations
           </div>
         </ng-template>
   
       </p-table>
                <!--p-table #dt [value]="organisation"  styleClass="p-datatable-customers" [rowHover]="true" 
                [rows]="5" [showCurrentPageReport]="true" [rowsPerPageOptions]="[5,10,15,25,50]" dataKey="id"
                [paginator]="true" currentPageReportTemplate="Liste {first} à {last} pour {totalRecords} entrées"
                 [globalFilterFields]="['name']">
            
                 <ng-template pTemplate="caption">
                    <div class="flex">
                        <span class="p-input-icon-left ml-auto cherch">
                            <input 
                                pInputText 
                                type="text" 
                                #searchInput 
                                (input)="dt.filterGlobal(searchInput.value, 'contains')" 
                                placeholder="Rechercher" />
                        </span>
                    </div>
                </ng-template>
                
                <ng-template pTemplate="header">
                    <tr class="tableEnt">
                        <th >Nom</th>
                        <th >Organisation parent</th>
                        <th >Description</th>
    
                    </tr>
            
                    
                </ng-template>
                <ng-template id="bodi" pTemplate="body" let-organisation>
                    <tr class="p-selectable-row tableContenu">
                      
                        <td>
                           {{organisation.name}}
                        </td>
                        <td *ngIf="organisation.parentOrganisation != null">
                            {{ organisation.parentOrganisation.name }}
                        </td>
                        <td *ngIf="organisation.parentOrganisation == null">
                             ""
                        </td>
                        <td>
                            {{organisation.description}}
                        </td>
                       
                     
                      
                    </tr>
                </ng-template>
                </p-table-->
            
            </div>
        </p-tabPanel>
        
        <p-tabPanel *ngIf="utilisateur && procedure && (utilisateur.role === PROCEDURE_MANAGER || utilisateur.role === 'Manager de procedure')" header="Procedure">
            <div class="card">
                <p-table #dt [value]="procedure"  styleClass="p-datatable-customers" [rowHover]="true" 
                [rows]="5" [showCurrentPageReport]="true" [rowsPerPageOptions]="[5,10,15,25,50]" dataKey="id"
                [paginator]="true" currentPageReportTemplate="Liste {first} à {last} pour {totalRecords} entrées"
                 [globalFilterFields]="['name']">
            
                 <ng-template pTemplate="caption">
                    <div class="flex">
                        <span class="p-input-icon-left ml-auto cherch">
                            <i class="pi pi-search" ></i>
                            <input 
                                pInputText 
                                type="text" 
                                #searchInput 
                            (input)="dt.filterGlobal(searchInput.value, 'contains')" 
                            placeholder="      Rechercher" />
                        </span>
                    </div>
                </ng-template>
                
                <ng-template pTemplate="header">
                    <tr class="tableEnt">
                        <!--th style="width: 4rem,">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th-->
                        <th >Nom</th>
                        <th >Organisation</th>
                        <th >Statut</th>
                        <!--th >Etat</th-->
    
                    </tr>
            
                    
                </ng-template>
                <ng-template id="bodi" pTemplate="body" let-procedure>
                    <tr class="p-selectable-row tableContenu">
                        <!--td>
                            <p-tableCheckbox  class="rounded-lg" [value]="utilisateur"></p-tableCheckbox>
                        </td-->
                        <td>
                           {{procedure.name}}
                        </td>
                        <td>
                            {{procedure.organisation.name}}
                        </td>
                       
                        <td>
                            {{ parseStatus(procedure.status) }} 
                        </td>
                       
                        <!--td>
                            {{procedure.isActive}}
                        </td-->
                      
                    </tr>
                </ng-template>
                </p-table>
            
            </div>
        </p-tabPanel>
    </p-tabView>
</div>


